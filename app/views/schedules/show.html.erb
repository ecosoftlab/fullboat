<% content_for :record do %>
  <p><%= link_to("Manage Slots", schedule_slots_path(@schedule)) %></p>
  <p><%= link_to("Add a New Slot", new_schedule_slot_path(@schedule)) %></p>
<% end %>

<h1><%= h @schedule %></h1>
<%= @schedule.description %>

<!-- Frankly, this is terrifying -->
<table class="schedule">
  <colgroup span="8">
    <column class="time"></column>
  <% %w{sunday monday tuesday wednesday thursday friday saturday}.each do |day| -%>
    <column class="<%= day %>"></column>
  <% end -%>
  </colgroup>
  
  <thead>
    <th class="time">Time</th>
  <% %w{sunday monday tuesday wednesday thursday friday saturday}.each do |day| -%>
    <th class="day"><%= day.capitalize %></th>
  <% end -%>
  </thead>
  
  <tbody>
  <% (0..23).collect{|h| Time.parse("%d:00" % h)}.each do |time| %>
    <tr id="hour-<%= time.hour %>" class="<%= cycle('odd', 'even') %>">
      <td><%= time.to_ordinalized_s(:time_only) %>
    <% (0..6).each do |day| -%>
      <% slot = @schedule.slot_starting_at(day, time) -%>
      <% program = slot.program rescue nil -%>
      <% if program -%>
        <td class="" rowspan="<%= slot.duration %>">
          <div>
            <%= link_to(h(program), program_path(program)) -%>
          </div>
        </td>
      <% elsif @schedule.slot_at(day, time) -%>
        <!-- Empty Slot -->
      <% else -%>
        <td></td>
      <% end -%>
    <% end -%>
    </tr>
  <% end %>
  </tbody>
</table>